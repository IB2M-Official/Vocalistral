<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Vocalistral Traducteur</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  :root {
    --orange: #ff9800;
    --dark: #1a1a1a;
    --light-dark: #2e2e2e;
    --white: #f0f0f0;
    --gray: #444;
  }

  * { box-sizing: border-box; }

  body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    background-color: var(--light-dark);
    color: var(--white);
    display: flex;
    height: 100vh;
    overflow: hidden;
  }

  #sidebar {
    width: 260px;
    background: var(--dark);
    position: fixed;
    height: 100%;
    z-index: 2;
    overflow-y: auto;
    transform: translateX(-100%);
    transition: transform 0.3s;
    padding: 1rem;
  }

  #sidebar.visible { transform: translateX(0); }

  #main {
    flex: 1;
    display: flex;
    flex-direction: column;
    height: 100vh;
    margin-left: 0;
    transition: margin-left 0.3s;
  }

  header {
    background: var(--orange);
    padding: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: white;
  }

  #toggleSidebar {
    font-size: 1.5rem;
    background: none;
    border: none;
    color: var(--white);
    cursor: pointer;
  }

  #translate-section {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    padding: 1rem;
    gap: 1rem;
    max-width: 900px;
    margin: 0 auto;
  }

  .lang-block {
    background: var(--gray);
    padding: 1rem;
    border-radius: 10px;
    position: relative;
  }

  .lang-block select {
    width: 100%;
    padding: 0.5rem;
    font-size: 1rem;
    border-radius: 6px;
    border: none;
    margin-bottom: 0.5rem;
  }

  textarea {
    width: 100%;
    resize: vertical;
    min-height: 100px;
    font-size: 1rem;
    padding: 0.5rem;
    border-radius: 6px;
    border: none;
  }

  .btn-row {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .mic-btn, .listen-btn, .pause-btn {
    background: var(--orange);
    color: black;
    border-radius: 6px;
    border: none;
    padding: 0.5rem 1rem;
    cursor: pointer;
    font-size: 1.1rem;
  }

  #translateRow {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
  }

  #translateBtn {
    padding: 0.75rem 2rem;
    font-size: 1.2rem;
    background: var(--orange);
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
  }

  #swapBtn {
    background: none;
    border: none;
    color: var(--white);
    font-size: 1.8rem;
    cursor: pointer;
    transition: transform 0.4s ease;
  }

  #swapBtn.animate {
    transform: rotate(180deg);
  }

  ul.chat-list {
    list-style: none;
    padding: 0;
  }

  .chat-list li {
    background: #444;
    color: white;
    padding: 0.5rem;
    margin: 0.5rem 0;
    border-radius: 4px;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .chat-list button {
    background: none;
    border: none;
    color: red;
    font-weight: bold;
    cursor: pointer;
  }

  @media (max-width: 600px) {
    .btn-row {
      flex-direction: column;
      align-items: stretch;
    }
  }
</style>

</head>
<body>

  <div id="sidebar">
    <button id="closeSidebar" style="float:right;font-size:1.2rem;color:white;background:none;border:none;cursor:pointer;">√ó</button>
    <h3>Conversations</h3>
    <ul id="chatList" class="chat-list"></ul>
  </div>

  <div id="main">
    <header>
      <button id="toggleSidebar">‚ò∞</button>
      <h2>Vocalistral Traducteur</h2>
    </header>
    <div id="translate-section">
      <div class="lang-block">
        <input id="topLangInput" list="langList" placeholder="Langue source">
<input id="bottomLangInput" list="langList" placeholder="Langue cible">
<datalist id="langList"></datalist>

        <div class="btn-row">
  <button class="mic-btn" onclick="startVoice('top')">üé§ Parler</button>
  <button class="listen-btn" onclick="speakTop()">üîà √âcouter</button>
  <button class="pause-btn" onclick="speechSynthesis.cancel()">‚è∏ Pause</button>
</div>

        <textarea id="topText" placeholder="Parle ou √©cris ici..."></textarea>
      </div>
<div id="translateRow">
  <button id="translateBtn">Traduire ‚Æû</button>
  <button id="swapBtn" title="Inverser les langues">üîÅ</button>
</div>
      <div class="lang-block">
        <input id="topLangInput" list="langList" placeholder="Langue source">
<input id="bottomLangInput" list="langList" placeholder="Langue cible">
<datalist id="langList"></datalist>

        <div class="btn-row">
  <button class="listen-btn" onclick="speakBottom()">üîà √âcouter</button>
  <button class="pause-btn" onclick="speechSynthesis.cancel()">‚è∏ Pause</button>
</div>

        <textarea id="bottomText" readonly placeholder="Traduction..."></textarea>
      </div>
    </div>
  </div>

  <script>
    const API_KEY = "CjVcFT9mRjOtTqG7er5Z5uYe4Y6h2yjU"; // Remplace ici
    const API_URL = "https://api.mistral.ai/v1/chat/completions";

    const topLang = document.getElementById("topLang");
    const bottomLang = document.getElementById("bottomLang");
    const topText = document.getElementById("topText");
    const bottomText = document.getElementById("bottomText");
    const chatList = document.getElementById("chatList");

    const languages = {
      "af": "Afrikaans", "ar": "Arabic", "bn": "Bengali", "zh": "Chinese",
      "en": "English", "fr": "French", "de": "German", "hi": "Hindi",
      "it": "Italian", "ja": "Japanese", "ko": "Korean", "pt": "Portuguese",
      "ru": "Russian", "es": "Spanish", "tr": "Turkish", "nl": "Dutch",
      "pl": "Polish", "ro": "Romanian", "sv": "Swedish", "vi": "Vietnamese"
      "af": "Afrikaans", "ar": "Arabic", "az": "Azerbaijani", "bg": "Bulgarian",
    "bn": "Bengali", "ca": "Catalan", "cs": "Czech", "da": "Danish", "de": "German",
    "el": "Greek", "en": "English", "es": "Spanish", "et": "Estonian", "fa": "Persian",
    "fi": "Finnish", "fr": "French", "gu": "Gujarati", "he": "Hebrew", "hi": "Hindi",
    "hr": "Croatian", "hu": "Hungarian", "id": "Indonesian", "it": "Italian", "ja": "Japanese",
    "jv": "Javanese", "ka": "Georgian", "kn": "Kannada", "ko": "Korean", "lt": "Lithuanian",
    "lv": "Latvian", "ml": "Malayalam", "mr": "Marathi", "ms": "Malay", "nb": "Norwegian",
    "nl": "Dutch", "pl": "Polish", "pt": "Portuguese", "ro": "Romanian", "ru": "Russian",
    "sk": "Slovak", "sl": "Slovenian", "sr": "Serbian", "sv": "Swedish", "ta": "Tamil",
    "te": "Telugu", "th": "Thai", "tr": "Turkish", "uk": "Ukrainian", "ur": "Urdu",
    "vi": "Vietnamese", "zh": "Chinese"
    };

    function populateLanguages() {
  const langList = document.getElementById("langList");
  for (const [code, name] of Object.entries(languages)) {
    const option = document.createElement("option");
    option.value = `${name} [${code}]`;
    langList.appendChild(option);
  }
}

function getLangCode(inputValue) {
  const match = inputValue.match(/\[(.*?)\]/);
  return match ? match[1] : "en";
}


    populateLanguages();

    document.getElementById("toggleSidebar").onclick = () => {
      document.getElementById("sidebar").classList.toggle("visible");
    };
    document.getElementById("closeSidebar").onclick = () => {
      document.getElementById("sidebar").classList.remove("visible");
    };

    async function translateText() {
      const input = topText.value.trim();
      if (!input) return;

      const from = getLangCode(topLangInput.value);
      const to = bottomLang.value;

      const prompt = `Traduis ce texte s√©mantiquement du ${languages[from]} vers le ${languages[to]} : "${input}". Renvoie que le texte traduit s√©mantiquement.`;

      const messages = [
        { role: "system", content: "Tu es un assistant traducteur en sens qui ne renvoie que le texte traduit.." },
        { role: "user", content: prompt }
      ];

      const res = await fetch(API_URL, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${API_KEY}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          model: 'mistral-large-latest',
          messages,
          max_tokens: 200,
          temperature: 0.5
        })
      });

      if (!res.ok) {
        bottomText.value = `[Erreur API ${res.status}]`;
        return;
      }

      const data = await res.json();
      const translated = data.choices?.[0]?.message?.content || "[Pas de r√©ponse]";
      bottomText.value = translated;
      saveHistory(input, translated);
    }

    document.getElementById("translateBtn").onclick = translateText;

    function startVoice(target) {
      const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = getLangCode(topLangInput.value);
      recognition.start();
      recognition.onresult = e => {
        const text = e.results[0][0].transcript;
        if (target === 'top') {
          topText.value = text;
        }
      };
    }

    function speakBottom() {
      const utterance = new SpeechSynthesisUtterance(bottomText.value);
      utterance.lang = bottomLang.value;
      const voice = speechSynthesis.getVoices().find(v => v.lang.startsWith(bottomLang.value));
      if (voice) utterance.voice = voice;
      speechSynthesis.speak(utterance);
    }

    // Pr√©charger les voix
    window.speechSynthesis.onvoiceschanged = () => {};

    // Historique
    let history = JSON.parse(localStorage.getItem("translations") || "[]");
    function saveHistory(original, translated) {
      const id = Date.now();
      const item = { id, original, translated };
      history.unshift(item);
      localStorage.setItem("translations", JSON.stringify(history));
      populateChatList();
    }

    function populateChatList() {
      chatList.innerHTML = "";
      history.forEach(item => {
        const li = document.createElement("li");
        li.innerHTML = `
          ${item.original.slice(0, 12)}...
          <button onclick="deleteChat(${item.id})">√ó</button>
        `;
        li.onclick = () => {
          topText.value = item.original;
          bottomText.value = item.translated;
        };
        chatList.appendChild(li);
      });
    }

    function deleteChat(id) {
      history = history.filter(item => item.id !== id);
      localStorage.setItem("translations", JSON.stringify(history));
      populateChatList();
    }

    document.getElementById("swapBtn").onclick = () => {
  const topLangVal = getLangCode(topLangInput.value);
  getLangCode(topLangInput.value) = bottomLang.value;
  bottomLang.value = topLangVal;

  const topTextVal = topText.value;
  topText.value = bottomText.value;
  bottomText.value = topTextVal;

  const btn = document.getElementById("swapBtn");
  btn.classList.add("animate");
  setTimeout(() => btn.classList.remove("animate"), 400);
};

function speakTop() {
  const utterance = new SpeechSynthesisUtterance(topText.value);
  utterance.lang = getLangCode(topLangInput.value);
  const voice = speechSynthesis.getVoices().find(v => v.lang.startsWith(getLangCode(topLangInput.value)));
  if (voice) utterance.voice = voice;
  speechSynthesis.speak(utterance);
}



    populateChatList();

    
  </script>
</body>
</html>
